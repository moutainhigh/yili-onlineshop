"use strict";

(function($) {
    $(function() {
        var win_H = $(window).height();

        $('.container').css('min-height', win_H);

        resizeDiscount();
        $(window).resize(function() {
            resizeDiscount();
        });

        /*radio*/
        $('.radio').find('.checkItem').click(function() {
          $('.radio').find('.checkItem').removeAttr('checked').parents('.check-box').removeClass('checked');
          $(this).attr('checked', 'checked').parents('.check-box').addClass('checked');
        });
        /*checkbox*/
        $('.checkbox').find('.checkItem').each(function() {
            $(this).click(function() {
                if (this.checked) {
                    $(this).attr('checked', 'checked').parents('.check-box').addClass('checked');
                } else {
                    $(this).removeAttr('checked').parents('.check-box').removeClass('checked');
                }
            });
        });

        var checkItem = document.getElementsByName('checkItem');
        var checkAllBtn = document.getElementById('checkAll');
        $('#checkAll').click(function() {
            if (this.checked) {
                for(var i=0;i<checkItem.length;i++){
                    checkItem[i].checked = true;
                    $('.checkbox').eq(i).find('input').attr('checked', 'checked').parents('.check-box').addClass('checked');
                }
            } else {
                $('.checkbox').find('input').removeAttr('checked').parents('.check-box').removeClass('checked');
            }
        });

        /*cart.html 全选*/
        $('.cart-wrap').find('.cart-item .checkItem').click(function() {
            if ($('.cart-item').find('.checked').length===checkItem.length) {
                checkAllBtn.checked = true;
                $(checkAllBtn).parents('.check-box').addClass('checked');
            } else {
                checkAllBtn.checked = false;
                $(checkAllBtn).parents('.check-box').removeClass('checked');
            }
        });

        /*ios-btn*/
        $('.ios-btn input').each(function() {
            $(this).click(function() {
                if (this.checked) {
                    $(this).parents('.ios-btn').addClass('thisChecked');
                    $(this).attr('checked', 'checked');
                } else {
                    $(this).parents('.ios-btn').removeClass('thisChecked');
                    $(this).removeAttr('checked');
                }
            });
        });

        /*无评论*/
        $('.rank-box').each(function() {
            if (!$(this).find('.rank-item').length) {
                var noRank = '<div class="noRank"><span></span><p>大家还没有发表自己的看法 ！</p></div>';
                $(this).append(noRank);
            }
        });

        /*无订单*/
        $('.order-wrap').each(function() {
            if (!$(this).find('.order-box').length) {
                var noOrder = '<div class="order-none fl wp100"><span></span><p>您还没有相关订单！</p></div>';
                $(this).append(noOrder);
            }
        });

        /*隐藏弹出框*/
        var cancelBtn = $('.modal-wrap').find('.cancel');
        cancelBtn.click(function() {
            $('.modal-wrap').fadeOut();
        });

        /*切换显示底部菜单*/
        $('#menuFixed').click(function() {
            var menu = $('.menu-wrap');
            if (menu.hasClass('open')) {
                menu.removeClass('open').stop().animate({bottom:'-100%'});
                $('body').stop().animate({'padding-bottom':0});
            } else {
                menu.addClass('open').stop().animate({bottom:0});
                $('body').stop().animate({'padding-bottom':51});
            }
        });
        /*回到顶部*/
        $('#topFixed').click(function() {
            $('body,html').stop().animate({ scrollTop: 0 });
        })
        $(window).scroll(function(event) {
            var H = $(window).scrollTop();
            if ( H>win_H ) {
                $('#topFixed').fadeIn();
            } else {
                $('#topFixed').fadeOut();
            }
        });

        /*menu.html 左侧菜单*/
        resizeMenu();
        $(window).resize(function(event) {
            resizeMenu();
        });

        /*关闭分享*/
        $('#shareModal').click(function(event) {
           closeShareModal();
        });

        $('.disabled-btn').click(function(event) {
            $('#iconDisabled').fadeIn();
        });

        /*隐藏首页背景图*/
        $('#indexBack').click(function(event) {
            $('#indexBack').fadeOut();
            var menu = $('.menu-wrap');
            menu.addClass('open').stop().animate({bottom:0});
            $('body').stop().animate({'padding-bottom':51});
        });

        $('#Menu').find('.menu-box img').each(function(index, el) {
            $(this).height($(this).width());
        });

    });
})(jQuery);

function GetQueryString(name){
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if(r!==null)return  unescape(r[2]); return null;
}

function resizeDiscount() {
    var win_W = $(window).width();
    var discount_a_w = win_W*0.975*0.475;
    $('.discount-wrap').find('a').css({
      'width': discount_a_w,
      'height': discount_a_w+60
    });
}

function resizeMenu(){
    $('#Menu').find('.menu-l').css('width', $('.container').width()*0.25);
}

function openModal(status,text,speed) {
    var modal="";
    if (status=="0") {
        if (text==undefined) {
            text="操作失败"
        };
        var modal = '<div class="status-modal">' + text + '</div>';
    } else {
        if (text==undefined) {
            text="操作成功"
        }
        var modal = '<div class="status-modal">' + text + '</div>';
    };
    if (speed==undefined) {
        speed=800;
    };

    $('body').append(modal);
    $('.status-modal').fadeIn(400);
    setTimeout(function(){
        $('.status-modal').fadeOut(300);
    },speed);

    setTimeout(function(){
        $('body').find('.status-modal').remove();
    },speed+200);
}

function openShareModal(){
    var wrap = $('#shareModal');
    var box = $('.share-wrap');

    wrap.fadeIn();
    box.velocity({bottom:'0'});
}
function closeShareModal(){
    var wrap = $('#shareModal');
    var box = $('.share-wrap');

    wrap.fadeOut();
    box.velocity({bottom:'-100%'});
}
