<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.aladingshop.sku.cms.dao.SkuDao">
	<resultMap id="skuMap" type="Sku">
		<id column="id" property="id" />
		<result column="product_code" property="productCode" />
		<result column="unique_code" property="uniqueCode" />
		<result column="bar_code" property="barCode" />
		<result column="sku_no" property="skuNo" />
		<result column="color" property="color" />
		<result column="size" property="size" />
		<result column="name" property="name" />
		<result column="status" property="status" />
		<result column="category_code" property="categoryCode" />
		<result column="brand_code" property="brandCode" />
		<result column="quota_num" property="quotaNum"/>
		<result column="showorder" property="showorder"/>
		<result column="description" property="description"/>
		<result column="create_id" property="createId"/>
		<result column="update_id" property="updateId"/>
		<result column="update_time" property="updateTime"/>
		<result column="create_time" property="createTime" />
		
		<result column="store_code" property="storeCode" />
	</resultMap>
	
	<insert id="insert" parameterType="Sku"  useGeneratedKeys="true" keyProperty="id">
	
		insert into 
			t_sku(product_code,unique_code,bar_code,sku_no,color,size,name,category_code,brand_code,
				status,quota_num,description,showorder,create_id,create_time,store_code)
		values
			(#{productCode},#{uniqueCode},#{barCode},#{skuNo},#{color},#{size},#{name},#{categoryCode},#{brandCode},
				#{status},#{quotaNum},#{description},#{showorder},#{createId},now(),#{storeCode})
	</insert>
	
	<sql id="Base_Column_List">
		select 	
			id,product_code,unique_code,bar_code,sku_no,color,size,name,category_code,brand_code,
				status,quota_num,description,showorder,create_id,create_time,update_id,update_time,store_code
		from
			t_sku
	</sql>
	
	<delete id="deleteById" parameterType="java.lang.Long">
		delete from 
			t_sku
		where 
			id = #{id}
	</delete>
	
	<select id="findById" resultMap="skuMap" parameterType="long">
		<include refid="Base_Column_List" />
		where 
			id = #{id} 
	</select>
	
	<select id="findAll" resultMap="skuMap" resultType="list">
		<include refid="Base_Column_List" />
	</select>
	<select id="findExcelAll" resultType="list" resultMap="skuMap" parameterType="Map">
		<include refid="Base_Column_List" /> 
		<where>
			<if test="skuCodes !=null and skuCodes !=''">
					and unique_code in  (${skuCodes})
			</if>
			<if test="noSkuCodes !=null and noSkuCodes !=''">
					and unique_code not in  (${noSkuCodes})
			</if>
			<if test="uniqueCode !=null and uniqueCode!=''">
				and unique_code =   #{coduniqueCode}
			</if>
			<if test="barCode !=null and barCode != ''">
				and bar_code = #{barCode}
			</if>
			<if test="skuNo !=null and skuNo != ''">
				and sku_no = #{skuNo}
			</if>
			
			<if test="productCode !=null and productCode !=''">
				and product_code = #{productCode}
			</if>
			<if test="name !=null and name != ''">
				and name like "%"#{name}"%"
			</if>
			<if test="status==null or status==''">
				and status !='9'
			</if>
			<if test="status !=null and status != ''">
				and status = #{status}
			</if>
			<if test="brandCode !=null and brandCode !=''">
				and brand_code = #{brandCode}
			</if>
			
			<if test="categoryCode !=null and categoryCode !=''">
				and category_code = #{categoryCode}
			</if>
			<if test="grandCategoryCode !=null and grandCategoryCode!=''">
				and category_code  like #{grandCategoryCode}"%"
			</if>
		    <if test="createTimeFrom != null and createTimeFrom !=''">
		    	<![CDATA[
					and DATE_FORMAT(create_time,'%Y-%m-%d') >= DATE_FORMAT(#{createTimeFrom}, '%Y-%m-%d')
				]]>
		    </if>
			<if test="createTimeTo != null and createTimeTo != ''">
		    	<![CDATA[
					and DATE_FORMAT(create_time,'%Y-%m-%d') <= DATE_FORMAT(#{createTimeTo}, '%Y-%m-%d')
				]]>
		    </if>
		    <if test="storeCode !=null and storeCode !=''">
				and store_code = #{storeCode}
			</if>
		</where>
			order by create_time desc,sku_no
	</select>
	<update id="update" parameterType="Sku">
		update 
			t_sku
		set
			<if test="productCode !=null and productCode !=''">
				product_code = #{productCode},
			</if>
		    <if test="barCode != null and barCode !=''">
				bar_code = #{barCode},
			</if>
			<if test="skuNo != null and skuNo !=''">
				sku_no = #{skuNo},
			</if>
			<if test="name != null and name !=''">
				name = #{name},
			</if>
			<if test="color != null and color !=''">
				color = #{color},
			</if>
			<if test="size != null and size !=''">
				size = #{size},
			</if>
			<if test="categoryCode !=null and categoryCode !=''">
				category_code = #{categoryCode},
			</if>
			<if test="brandCode !=null and brandCode !=''">
				brand_code = #{brandCode},
			</if>
			<if test="status != null and status !=''">
				status = #{status},
			</if>
			<if test="description!=null and description!=''">
				description = #{description},
			</if>
			<if test="showorder!=null ">
				showorder = #{showorder},
			</if>
			<if test="updateId!=null">
				update_id = #{updateId},
			</if>
			
			<if test="storeCode !=null and storeCode !=''">
				store_code = #{storeCode},
			</if>
			
			quota_num = #{quotaNum},
			update_time = now()
		where 
			id = #{id}
		
	</update>
	
	
	<select id="queryBySameDayOperateing" resultType="list" resultMap="skuMap" >
		select 	
			id,product_code,unique_code,bar_code,sku_no,color,size,name,category_code,brand_code,
				status,quota_num,description,showorder,create_id,create_time,update_time,store_code
		from
			t_sku
		where 
			status = '2' and (TO_DAYS(create_time) = TO_DAYS(NOW()) or TO_DAYS(update_time) = TO_DAYS(NOW())) 
	</select>
	
	
	<!-- 通过商品编号查询商品 -->
	<select id = "queryBySkuNo"  resultMap="skuMap" >
		<include refid="Base_Column_List" />
		<where> 
			sku_no = #{skuNo}  
			<if test="storeCode==null or storeCode=='' or storeCode=='999'">
				and (store_code is null or store_code='' or store_code='999')
			</if>
			<if test="storeCode!=null and storeCode !='' and storeCode!='999'">
				and store_code=#{storeCode}
			</if>
		</where>
	</select>
	<!-- 通过商品 条形编号查询商品 -->
	<select id = "queryByBarCode"  resultMap="skuMap">
		<include refid="Base_Column_List" />
		<where> 
			bar_code = #{barCode}  
		<if test="storeCode==null or storeCode=='' or storeCode=='999'">
			and (store_code is null or store_code ='' or store_code='999') 
		</if>
		<if test="storeCode!=null and storeCode!='' and storeCode!='999'">
			and store_code=#{storeCode}
		</if>
	</where>
	</select>
	
	<!-- 通过商品唯一编号查询商品 -->
	<select id = "queryByUniqueCode"  resultMap="skuMap" parameterType="java.lang.String">
		<include refid="Base_Column_List" />
		where 
			unique_code = #{uniqueCode}
	
	</select>
	
	<!-- 通过产品编号查询商品 -->
	
	<select id = "queryByProductCode"  resultMap="skuMap" parameterType="java.lang.String">
		<include refid="Base_Column_List" />
		where 
			product_code = #{productCode}
	
	</select>
	
	
	<!-- 通过品牌编号查询商品 -->
	<select id = "queryByBrandCode"  resultMap="skuMap" parameterType="java.lang.String">
		<include refid="Base_Column_List" />
		where 
			brand_code = #{brandCode}
	
	</select>
	<select id = "queryByStroeCode"  resultMap="skuMap" parameterType="java.lang.String">
		<include refid="Base_Column_List" />
		where 
			store_code = #{storeCode}
	
	</select>
	
	<!-- 分页查询商品信息 -->
	<select id="getPageList" resultType="list" resultMap="skuMap" parameterType="Map">
		<include refid="Base_Column_List" />
		<where>
			<if test="skuCodes !=null and skuCodes !=''">
				and unique_code in  (${skuCodes})
			</if>
			<if test="noSkuCodes !=null and noSkuCodes !=''">
				and unique_code not in  (${noSkuCodes})
			</if>
			<if test="uniqueCode !=null and uniqueCode!=''">
				and unique_code = #{uniqueCode}
			</if>
			<if test="barCode !=null and barCode != ''">
				and bar_code = #{barCode}
			</if>
			<if test="skuNo !=null and skuNo != ''">
				and sku_no = #{skuNo}
			</if>
			<if test="productCode !=null and productCode !=''">
				and product_code = #{productCode}
			</if>
			<if test="name !=null and name != ''">
				and name like "%"#{name}"%"
			</if>
			<if test="status==null or status==''">
				and status !='9'
			</if>
			<if test="status !=null and status != ''">
				and status = #{status}
			</if>
			<if test="brandCode !=null and brandCode !=''">
				and brand_code = #{brandCode}
			</if>
			<if test="categoryCode !=null and categoryCode !=''">
				and category_code = #{categoryCode}
			</if>
			<if test="grandCategoryCode !=null and grandCategoryCode!=''">
				and category_code  like #{grandCategoryCode}"%"
			</if>
			
	   	    <if test="createTimeFrom != null and createTimeFrom !=''">
		    	<![CDATA[
					and DATE_FORMAT(create_time,'%Y-%m-%d %H:%i:%s') >= DATE_FORMAT(#{createTimeFrom}, '%Y-%m-%d %H:%i:%s')
				]]>
		    </if>
			<if test="createTimeTo != null and createTimeTo != ''">
		    	<![CDATA[
					and DATE_FORMAT(create_time,'%Y-%m-%d %H:%i:%s') <= DATE_FORMAT(#{createTimeTo}, '%Y-%m-%d %H:%i:%s')
				]]>
		    </if>
		    
		    <if test="updateTimeFrom != null and updateTimeFrom !=''">
		    	<![CDATA[
					and DATE_FORMAT(update_time,'%Y-%m-%d %H:%i:%s') >= DATE_FORMAT(#{updateTimeFrom}, '%Y-%m-%d %H:%i:%s')
				]]>
		    </if>
			<if test="updateTimeTo != null and updateTimeTo != ''">
		    	<![CDATA[
					and DATE_FORMAT(update_time,'%Y-%m-%d %H:%i:%s') <= DATE_FORMAT(#{updateTimeTo}, '%Y-%m-%d %H:%i:%s')
				]]>
		    </if>
		    
		    <if test="storeCode == null or storeCode == '' or storeCode=='999'">
		    	and (store_code is null or store_code='' or store_code='999')
		    </if>
		    
			<if test="storeCode != null and storeCode != '' and storeCode!='999'">
		    	and store_code=#{storeCode}
		    </if>
		    
		</where>
		order by create_time desc,product_code,sku_no
		<![CDATA[
			LIMIT #{start},#{limit}
		]]> 
	
	</select>
	
	<!-- 查询该表的总数  -->
	<select id="getTotal" parameterType="Map" resultType="java.lang.Integer">	
		select 	
			count(id)
		from
			t_sku
		<where>
			<if test="skuCodes !=null and skuCodes !=''">
				and unique_code in  (${skuCodes})
			</if>
			<if test="noSkuCodes !=null and noSkuCodes !=''">
				and unique_code not in  (${noSkuCodes})
			</if>
			<if test="uniqueCode !=null and uniqueCode!=''">
				and unique_code =   #{coduniqueCode}
			</if>
			<if test="barCode !=null and barCode != ''">
				and bar_code = #{barCode}
			</if>
			<if test="skuNo !=null and skuNo != ''">
				and sku_no = #{skuNo}
			</if>
			
			<if test="productCode !=null and productCode !=''">
				and product_code = #{productCode}
			</if>
			<if test="name !=null and name != ''">
				and name like "%"#{name}"%"
			</if>
			<if test="status==null or status==''">
				and status !='9'
			</if>
			<if test="status !=null and status != ''">
				and status = #{status}
			</if>
			<if test="brandCode !=null and brandCode !=''">
				and brand_code = #{brandCode}
			</if>
			<if test="categoryCode !=null and categoryCode !=''">
				and category_code = #{categoryCode}
			</if>
			<if test="grandCategoryCode !=null and grandCategoryCode!=''">
				and category_code  like #{grandCategoryCode}"%"
			</if>
	    
		    <if test="createTimeFrom != null and createTimeFrom !=''">
		    	<![CDATA[
					and DATE_FORMAT(create_time,'%Y-%m-%d %H:%i:%s') >= DATE_FORMAT(#{createTimeFrom}, '%Y-%m-%d %H:%i:%s')
				]]>
		    </if>
			<if test="createTimeTo != null and createTimeTo != ''">
		    	<![CDATA[
					and DATE_FORMAT(create_time,'%Y-%m-%d %H:%i:%s') <= DATE_FORMAT(#{createTimeTo}, '%Y-%m-%d %H:%i:%s')
				]]>
		    </if>
	    	
	    
	     	<if test="updateTimeFrom != null and updateTimeFrom !=''">
		    	<![CDATA[
					and DATE_FORMAT(update_time,'%Y-%m-%d %H:%i:%s') >= DATE_FORMAT(#{updateTimeFrom}, '%Y-%m-%d %H:%i:%s')
				]]>
		    </if>
			<if test="updateTimeTo != null and updateTimeTo != ''">
		    	<![CDATA[
					and DATE_FORMAT(update_time,'%Y-%m-%d %H:%i:%s') <= DATE_FORMAT(#{updateTimeTo}, '%Y-%m-%d %H:%i:%s')
				]]>
		    </if>
		     <if test="storeCode == null or storeCode == '' or storeCode=='999'">
		    	and (store_code is null or store_code='' or store_code='999')
		    </if>
	   	    <if test="storeCode != null and storeCode != '' and storeCode!='999'">
		    	and store_code=#{storeCode}
		    </if>
		</where>
	</select>
	
	
	<!-- 分页查询商品信息 -->
	<select id="queryByCondition" resultType="list" resultMap="skuMap" parameterType="com.fushionbaby.common.condition.sku.SkuEntryQueryCondition">
		select 	
			id,product_code,unique_code,bar_code,sku_no,color,size,name,category_code,brand_code,
				status,quota_num,description,showorder,create_id,create_time
		from
			t_sku
		<where>
			<if test="skuCodeList !=null and skuCodeList.size() > 0">
				and unique_code in 
				<foreach collection="skuCodeList" index="index" item="citem" open="(" separator="," close=")">
					#{citem}
				</foreach>
			</if>
			<if test="barCode !=null and barCode != ''">
				and bar_code = #{barCode}
			</if>
			<if test="skuCode !=null and skuCode != ''">
				and unique_code = #{skuCode}
			</if>
			<if test="skuNo !=null and skuNo != ''">
				and sku_no = #{skuNo}
			</if>
			<if test="productCode !=null and productCode !=''">
				and product_code = #{productCode}
			</if>
			<if test="name !=null and name != ''">
				and name like "%"#{name}"%"
			</if>
			<if test="searchKey !=null and searchKey != ''">
				and name like "%"#{searchKey}"%"
			</if>
			<if test="status==null or status==''">
				and status !='9'
			</if>
			<if test="status !=null and status != ''">
				and status = #{status}
			</if>
			<if test="brandCode !=null and brandCode !=''">
				and brand_code = #{brandCode}
			</if>
			<if test="categoryCodes!=null and categoryCodes.size()>0">
				and category_code in
				<foreach collection="categoryCodes" index="index" item="itemCode" open="(" separator="," close=")">
					#{itemCode}
				</foreach>
			</if>
			<if test="categoryCode !=null and categoryCode !='' and categoryCodes==null">
				and category_code = #{categoryCode}
			</if>
			 <if test="storeCode == null or storeCode == '' or storeCode =='999'">
		    	and (store_code is null or store_code='' or store_code='999')
		    </if>
			<if test="storeCode != null and storeCode != '' and storeCode!='999'">
		    	and store_code=#{storeCode}
		    </if>
		</where>
		order by case when  showorder=0 or showorder is null then 9999999 else showorder end
		<if test="start !=null and start>-1">
			LIMIT #{start}
		</if>
		<if test="start !=null and start>-1 and limit !=null and limit !=''">
			,#{limit}
		</if>
	
	</select>
	
	
	<select id = "findSkusByLikeName"  resultMap="skuMap" parameterType="java.lang.String">
		<include refid="Base_Column_List" />
		where 
			name like  "%"#{name}"%"
	
	</select>
	
	<select id="queryByStroeCodeAndSkuNo" resultMap="skuMap" parameterType="Map">
		<include refid="Base_Column_List" />
		<where>
		    <if test="storeCode == null or storeCode == '' or storeCode=='999'">
		    	and (store_code is null or store_code='' or store_code='999')
		    </if>
			<if test="storeCode != null and storeCode != '' and storeCode!='999'">
				and store_code = #{storeCode}
			</if>
			<if test="skuNo != null and skuNo != ''">
				and sku_no = #{skuNo}
			</if>
		</where>
	</select>
</mapper>